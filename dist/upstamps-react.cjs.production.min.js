"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),n=e(require("localforage")),a=e(require("lodash.isequal"));function o(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function c(e){o(i,n,a,c,u,"next",e)}function u(e){o(i,n,a,c,u,"throw",e)}c(void 0)}))}}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var u,s=(function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function c(e,t,r,n){var a=Object.create((t&&t.prototype instanceof l?t:l).prototype),o=new E(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return{value:void 0,done:!0}}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var c=w(i,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=u(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===s)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}(e,r,o),a}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var s={};function l(){}function f(){}function p(){}var h={};h[a]=function(){return this};var v=Object.getPrototypeOf,d=v&&v(v(k([])));d&&d!==t&&r.call(d,a)&&(h=d);var m=p.prototype=l.prototype=Object.create(h);function g(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function y(e){var t;this._invoke=function(n,a){function o(){return new Promise((function(t,o){!function t(n,a,o,i){var c=u(e[n],e,a);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,o,i)}),(function(e){t("throw",e,o,i)})):Promise.resolve(l).then((function(e){s.value=e,o(s)}),(function(e){return t("throw",e,o,i)}))}i(c.arg)}(n,a,t,o)}))}return t=t?t.then(o,o):o()}}function w(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,s;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function k(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=m.constructor=p,p.constructor=f,p[i]=f.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,i in e||(e[i]="GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(y.prototype),y.prototype[o]=function(){return this},e.AsyncIterator=y,e.async=function(t,r,n,a){var o=new y(c(t,r,n,a));return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(m),m[i]="Generator",m[a]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=k,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,s):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),b(r),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;b(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:k(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(u={exports:{}}),u.exports),l="https://services.upstamps.com/api",f=t.createContext({}),p=function(e,t){switch(t.type){case"set-flags":case"set-flags-error":case"set-remotes":case"set-remotes-error":return c({},e,t.payload);default:throw new Error("Unhandled action type")}},h=function(){var e=t.useContext(f);if(void 0===e)throw new Error("UpStampsContext must be used with UpStampsProvider!");return e},v=["A","B"],d=function(){var e=i(s.mark((function e(t,r){var n,a,o,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:return n=e.sent,e.next=6,n.json();case 6:return a=e.sent.ABTesting.filter((function(e){return e.name===r})),o=a.length>0,i=Math.floor(Math.random()*v.length),e.abrupt("return",{show:o,variant:v[i],loading:!1});case 14:throw e.prev=14,e.t0=e.catch(0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r){return e.apply(this,arguments)}}(),m=function(){var e=i(s.mark((function e(t,r,n){var a,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={name:r,varA:"A"===t?1:0,varB:"B"===t?1:0},e.next=4,fetch(n,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:JSON.stringify(a)});case 4:return o=e.sent,e.next=7,o.json();case 7:return e.abrupt("return",e.sent);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r,n){return e.apply(this,arguments)}}(),g=r.forwardRef((function(e,n){return r.useImperativeHandle(n,(function(){return{emitter:e.emitter}})),r.createElement(t.Fragment,null,e.children)})),y=function(e){var n=e.children,a=e.name,o=e.testRef,u=h(),f=t.useState({component:[],loading:!0,error:!1,variant:"A",show:!1}),p=f[0],v=f[1],y=u.state.params,w=l+"/"+y.clientId+"/"+y.projectKey+"/"+y.envKey+"/testing",x=function(e){var t=r.Children.map(n,(function(t){if(t.props.name===e)return t}));v((function(e){return c({},e,{component:t})}))};return t.useEffect((function(){!function(){var e=i(s.mark((function e(){var t,r,n,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d(w,a);case 3:r=(t=e.sent).show,n=t.loading,x(o=t.variant),v((function(e){return c({},e,{show:r,variant:o,loading:n})})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),v((function(e){return c({},e,{error:!0,loading:!1})}));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}()()}),[a,u.state.params]),p.loading||p.show?r.createElement(g,{ref:o,emitter:function(){var e=i(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(p.variant,a,w);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},p.component):null},w=function(e){var n=e.children,a=e.name;return r.cloneElement(r.createElement(t.Fragment,null),{name:a},r.createElement(t.Fragment,null,n))};w.displayName="ABTest.Variant",y.Variant=w;var x=r.forwardRef((function(e,n){return r.useImperativeHandle(n,(function(){return{emitter:e.emitter}})),r.createElement(t.Fragment,null,e.children)})),b=function(e){var a=e.children,o=e.name,u=e.testRef,f=e.localStorage,p=void 0!==f&&f,v=h(),g=t.useState({component:[],loading:!0,error:!1,variant:"A",show:!1}),y=g[0],w=g[1],b=v.state.params,E=l+"/"+b.clientId+"/"+b.projectKey+"/"+b.envKey+"/testing",k=function(e){var t=r.Children.map(a,(function(t){if(t.props.name===e)return t}));w((function(e){return c({},e,{component:t})}))};return t.useEffect((function(){!function(){var e=i(s.mark((function e(){var t,r,a,i,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getItem(o);case 3:if(t=e.sent,!p||null===t){e.next=10;break}console.log("ABTest local"),k(t.variant),w((function(e){return c({},e,t)})),e.next=21;break;case 10:return console.log("ABTest remote"),e.next=13,d(E,o);case 13:return a=(r=e.sent).show,i=r.loading,k(u=r.variant),w((function(e){return c({},e,{show:a,variant:u,loading:i})})),e.next=21,n.setItem(o,{show:a,variant:u,loading:i});case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),w((function(e){return c({},e,{error:!0,loading:!1})}));case 26:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(){return e.apply(this,arguments)}}()()}),[o,v.state.params]),y.loading||y.show?r.createElement(x,{ref:u,emitter:function(){var e=i(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(y.variant,o,E);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},y.component):null},E=function(e){var n=e.children,a=e.name;return r.cloneElement(r.createElement(t.Fragment,null),{name:a},r.createElement(t.Fragment,null,n))};E.displayName="ABTest.Variant",b.Variant=E;var k=function(e){var t=encodeURIComponent;return Object.keys(e).filter((function(t){return void 0!==e[t]&&e[t]&&null!==e[t]})).map((function(r){return t(r)+"="+t(e[r])})).join("&")},S=function(){var e=i(s.mark((function e(t,r,n){var a,o,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=k({name:r,country:n.country,client:n.client,clientType:n.clientType}),e.next=4,fetch(t+"?"+a,{method:"GET"});case 4:return o=e.sent,e.next=7,o.json();case 7:return e.abrupt("return",{segment:i=e.sent.segment,show:i.length>0,loading:!1});case 13:throw e.prev=13,e.t0=e.catch(0),e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,r,n){return e.apply(this,arguments)}}(),j=t.createContext({}),L=function(e,t){switch(t.type){case"set-scope":case"set-scope-error":return c({},e,t.payload);default:throw new Error("Unhandled action type")}};exports.ABTest=y,exports.ABTestLocal=b,exports.Flag=function(e){var n=e.children,a=e.name,o=h().state;return t.useMemo((function(){return-1!==o.flags.indexOf(a)}),[o.flags,a])?r.createElement(t.Fragment,null,n):null},exports.RemoteFlag=function(e){var n=e.children,a=e.name,o=h().state,i=t.useMemo((function(){return o.remotes.filter((function(e){return e.name===a}))}),[o.remotes,a]),c=t.useMemo((function(){return i.length>0}),[i]);return c?r.createElement(t.Fragment,null,n(c?i[0].data:{})):null},exports.ScopesContext=j,exports.ScopesProvider=function(e){var n=e.children,a=e.name,o=e.email,c=h(),u=t.useReducer(L,{loading:!0,error:!1,params:{name:a,email:o}}),f=u[0],p=u[1],v=c.state.params,d=v.clientId,m=v.projectKey,g=t.useMemo((function(){return{state:f,dispatch:p}}),[f,p]);return t.useEffect((function(){var e=!1,t=function(){var t=i(s.mark((function t(){var r,n;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=l+"/"+d+"/"+m+"/scopes/add",n={name:a,email:o},t.next=5,fetch(r,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:JSON.stringify(n)});case 5:window.localStorage.setItem("upstamps_scope_email",o),e||p({type:"set-scope",payload:{success:!0,loading:!1}}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),p({type:"set-scope-error",payload:{loading:!1,error:!0}});case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}();return window.localStorage.getItem("upstamps_scope_email")!==o&&t(),function(){e=!0}}),[o]),r.createElement(j.Provider,{value:g},n)},exports.Segment=function(e){var n=e.children,a=e.name,o=e.params,u=h(),f=t.useState({loading:!0,error:!1,show:!1}),p=f[0],v=f[1],d=u.state.params,m=l+"/"+d.clientId+"/"+d.projectKey+"/"+d.envKey+"/segment";return t.useEffect((function(){!function(){var e=i(s.mark((function e(){var t,r,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S(m,a,o);case 3:r=(t=e.sent).show,n=t.loading,v((function(e){return c({},e,{show:r,loading:n})})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),v((function(e){return c({},e,{error:!0,loading:!1})}));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}()()}),[a,u.state.params]),p.show?r.createElement(t.Fragment,null,n):null},exports.SegmentLocal=function(e){var o=e.children,u=e.name,f=e.params,p=e.localStorage,v=void 0!==p&&p,d=h(),m=t.useState({loading:!0,error:!1,show:!1}),g=m[0],y=m[1],w=d.state.params,x=l+"/"+w.clientId+"/"+w.projectKey+"/"+w.envKey+"/segment";return t.useEffect((function(){!function(){var e=i(s.mark((function e(){var t,r,o,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getItem(u);case 3:if(t=e.sent,!v||null===t){e.next=9;break}console.log("Segment local = "),y((function(e){return c({},e,{show:a(f,t.params),loading:!1})})),e.next=18;break;case 9:return e.next=11,S(x,u,f);case 11:return o=(r=e.sent).show,i=r.loading,console.log("Segment remote"),y((function(e){return c({},e,{show:o,loading:i})})),e.next=18,n.setItem(u,{show:o,loading:i,params:f});case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),y((function(e){return c({},e,{error:!0,loading:!1})}));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(){return e.apply(this,arguments)}}()()}),[u,d.state.params]),g.show?r.createElement(t.Fragment,null,o):null},exports.UpStampsContext=f,exports.UpStampsProvider=function(e){var a=e.children,o=e.clientId,c=e.envKey,u=e.projectKey,h=e.endpoint,v=void 0===h?l:h,d=t.useReducer(p,{loading:!0,error:!1,flags:[],remotes:[],params:{clientId:o,envKey:c,projectKey:u,endpoint:v}}),m=d[0],g=d[1],y=t.useMemo((function(){return{state:m,dispatch:g}}),[m,g]);return t.useEffect((function(){var e=!1,t=function(){var t=i(s.mark((function t(){var r,a,i;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(m.flags.length>0)){t.next=3;break}return t.abrupt("return");case 3:return r=v+"/"+o+"/"+u+"/"+c+"/flags",t.next=6,fetch(r);case 6:return a=t.sent,t.next=9,a.json();case 9:if(i=t.sent.flags.map((function(e){return e.name})),e){t.next=16;break}return g({type:"set-flags",payload:{flags:i,loading:!1}}),t.next=16,n.setItem("flags",i);case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),g({type:"set-flags-error",payload:{loading:!1,error:!0}});case 21:case"end":return t.stop()}}),t,null,[[0,18]])})));return function(){return t.apply(this,arguments)}}(),r=function(){var t=i(s.mark((function t(){var r,a,i;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(m.remotes.length>0)){t.next=3;break}return t.abrupt("return");case 3:return r=v+"/"+o+"/"+u+"/"+c+"/remotes",t.next=6,fetch(r);case 6:return a=t.sent,t.next=9,a.json();case 9:if(i=t.sent.remotes,e){t.next=15;break}return g({type:"set-remotes",payload:{remotes:i,loading:!1}}),t.next=15,n.setItem("remotes",i);case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),g({type:"set-remotes-error",payload:{loading:!1,error:!0}});case 20:case"end":return t.stop()}}),t,null,[[0,17]])})));return function(){return t.apply(this,arguments)}}();return t(),r(),function(){e=!0}}),[]),r.createElement(f.Provider,{value:y},a)},exports.useABTest=function(e){var r=h(),n=t.useState({loading:!0,error:!1,show:!1,variant:"A"}),a=n[0],o=n[1],u=r.state.params,f=l+"/"+u.clientId+"/"+u.projectKey+"/"+u.envKey+"/testing";return t.useEffect((function(){!function(){var t=i(s.mark((function t(){var r,n,a,i;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d(f,e);case 3:n=(r=t.sent).show,a=r.loading,i=r.variant,o((function(e){return c({},e,{show:n,variant:i,loading:a})})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),o((function(e){return c({},e,{error:!0,loading:!1})}));case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(){return t.apply(this,arguments)}}()()}),[e,r.state.params]),{show:a.show,error:a.error,loading:a.loading,variant:a.variant,emitter:function(){var t=i(s.mark((function t(){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,m(a.variant,e,f);case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return",t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}()}},exports.useABTestLocal=function(e,r){void 0===r&&(r=!1);var a=h(),o=t.useState({loading:!0,error:!1,show:!1,variant:"A"}),u=o[0],f=o[1],p=a.state.params,v=l+"/"+p.clientId+"/"+p.projectKey+"/"+p.envKey+"/testing";return t.useEffect((function(){!function(){var t=i(s.mark((function t(){var a,o,i,u,l;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.getItem(e);case 3:if(a=t.sent,!r||null===a){t.next=9;break}console.log("useABTest local"),f((function(e){return c({},e,a)})),t.next=19;break;case 9:return console.log("useABTest remote"),t.next=12,d(v,e);case 12:return i=(o=t.sent).show,u=o.loading,l=o.variant,f((function(e){return c({},e,{show:i,variant:l,loading:u})})),t.next=19,n.setItem(e,{show:i,variant:l,loading:u});case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(0),f((function(e){return c({},e,{error:!0,loading:!1})}));case 24:case"end":return t.stop()}}),t,null,[[0,21]])})));return function(){return t.apply(this,arguments)}}()()}),[e,a.state.params]),{show:u.show,error:u.error,loading:u.loading,variant:u.variant,emitter:function(){var t=i(s.mark((function t(){return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,m(u.variant,e,v);case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return",t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(){return t.apply(this,arguments)}}()}},exports.useFlag=function(e){var r=h().state;return{show:-1!==t.useMemo((function(){return r.flags}),[r.flags]).indexOf(e)}},exports.useRemoteFlag=function(e){var r=h().state,n=t.useMemo((function(){return r.remotes.filter((function(t){return t.name===e}))}),[r.remotes,e]),a=t.useMemo((function(){return n.length>0}),[n]);return{show:a,data:a?n[0].data:{}}},exports.useSegment=function(e,r){var n=h(),a=t.useState({loading:!0,error:!1,show:!1}),o=a[0],u=a[1],f=n.state.params,p=l+"/"+f.clientId+"/"+f.projectKey+"/"+f.envKey+"/segment";return t.useEffect((function(){!function(){var t=i(s.mark((function t(){var n,a,o;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,S(p,e,r);case 3:a=(n=t.sent).show,o=n.loading,u((function(e){return c({},e,{show:a,loading:o})})),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),u((function(e){return c({},e,{error:!0,loading:!1})}));case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}()()}),[e,n.state.params]),{show:o.show,error:o.error,loading:o.loading}},exports.useSegmentLocal=function(e,r,o){void 0===o&&(o=!1);var u=h(),f=t.useState({loading:!0,error:!1,show:!1}),p=f[0],v=f[1],d=u.state.params,m=l+"/"+d.clientId+"/"+d.projectKey+"/"+d.envKey+"/segment";return t.useEffect((function(){!function(){var t=i(s.mark((function t(){var i,u,l,f;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.getItem(e);case 3:if(i=t.sent,!o||null===i){t.next=9;break}console.log("useSegment local"),v((function(e){return c({},e,{show:a(r,i.params),loading:!1})})),t.next=18;break;case 9:return t.next=11,S(m,e,r);case 11:return l=(u=t.sent).show,f=u.loading,console.log("useSegment remote"),v((function(e){return c({},e,{show:l,loading:f})})),t.next=18,n.setItem(e,{show:l,loading:f,params:r});case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),v((function(e){return c({},e,{error:!0,loading:!1})}));case 23:case"end":return t.stop()}}),t,null,[[0,20]])})));return function(){return t.apply(this,arguments)}}()()}),[e,u.state.params]),{show:p.show,error:p.error,loading:p.loading}};
//# sourceMappingURL=upstamps-react.cjs.production.min.js.map
