"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("react"),r=(e=t)&&"object"==typeof e&&"default"in e?e.default:e;function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function o(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var a="https://services.upstamps.com/api",s=t.createContext({}),i=function(e,t){switch(t.type){case"set-flags":case"set-flags-error":case"set-remotes":case"set-remotes-error":return n({},e,{},t.payload);default:throw new Error("Unhandled action type")}},u=function(){var e=t.useContext(s);if(void 0===e)throw new Error("UpStampsContext must be used with UpStampsProvider!");return e};exports.Flag=function(e){var n=e.children,o=e.name,a=u().state;return t.useMemo((function(){return-1!==a.flags.indexOf(o)}),[a.flags,o])?r.createElement(t.Fragment,null,n):null},exports.RemoteFlag=function(e){var n=e.children,o=e.name,a=u().state,s=t.useMemo((function(){return a.remotes.filter((function(e){return e.name===o}))}),[a.remotes,o]),i=t.useMemo((function(){return s.length>0}),[s]);return i?r.createElement(t.Fragment,null,n(i?s[0].data:{})):null},exports.UpStampsContext=s,exports.UpStampsProvider=function(e){var n=e.children,u=e.clientId,c=e.envKey,l=e.projectKey,f=t.useReducer(i,{loading:!0,error:!1,flags:[],remotes:[],params:{clientId:u,envKey:c,projectKey:l}}),m=f[0],d=f[1],p=t.useMemo((function(){return{state:m,dispatch:d}}),[m,d]);return t.useEffect((function(){var e=!1;return function(){try{Promise.resolve(o((function(){if(!(m.flags.length>0))return Promise.resolve(fetch(a+"/"+u+"/"+l+"/"+c+"/flags")).then((function(t){return Promise.resolve(t.json()).then((function(t){var r=t.flags.map((function(e){return e.name}));e||d({type:"set-flags",payload:{flags:r,loading:!1}})}))}))}),(function(){d({type:"set-flags-error",payload:{loading:!1,error:!0}})})))}catch(e){return Promise.reject(e)}}(),function(){try{Promise.resolve(o((function(){if(!(m.remotes.length>0))return Promise.resolve(fetch(a+"/"+u+"/"+l+"/"+c+"/remotes")).then((function(t){return Promise.resolve(t.json()).then((function(t){e||d({type:"set-remotes",payload:{remotes:t.remotes,loading:!1}})}))}))}),(function(){d({type:"set-remotes-error",payload:{loading:!1,error:!0}})})))}catch(e){return Promise.reject(e)}}(),function(){e=!0}}),[m.flags,m.remotes,u,c,l]),r.createElement(s.Provider,{value:p},n)},exports.useABTest=function(e){var r=u(),s=t.useState({loading:!0,error:!1,show:!1,variant:"A"}),i=s[0],c=s[1],l=r.state.params,f=a+"/"+l.clientId+"/"+l.projectKey+"/"+l.envKey+"/testing",m=["A","B"];return t.useEffect((function(){!function(){try{var t=o((function(){return Promise.resolve(fetch(f)).then((function(t){return Promise.resolve(t.json()).then((function(t){var r=t.ABTesting.filter((function(t){return t.name===e})).length>0,o=Math.floor(Math.random()*m.length);c((function(e){return n({},e,{show:r,variant:m[o],loading:!1})}))}))}))}),(function(){c((function(e){return n({},e,{error:!0,loading:!1})}))}));Promise.resolve(t&&t.then?t.then((function(){})):void 0)}catch(e){return Promise.reject(e)}}()}),[e,r.state.params]),{show:i.show,error:i.error,loading:i.loading,variant:i.variant,emitter:function(){return Promise.resolve(o((function(){return Promise.resolve(fetch(f,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:JSON.stringify({name:e,varA:"A"===i.variant?1:0,varB:"B"===i.variant?1:0})})).then((function(e){return Promise.resolve(e.json())}))}),(function(e){return e})))}}},exports.useFlag=function(e){var r=u().state;return{show:-1!==t.useMemo((function(){return r.flags}),[r.flags]).indexOf(e)}},exports.useRemoteFlag=function(e){var r=u().state,n=t.useMemo((function(){return r.remotes.filter((function(t){return t.name===e}))}),[r.remotes,e]),o=t.useMemo((function(){return n.length>0}),[n]);return{show:o,data:o?n[0].data:{}}};
//# sourceMappingURL=upstamps-react.cjs.production.min.js.map
