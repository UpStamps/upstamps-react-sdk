"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("react"),r=(e=t)&&"object"==typeof e&&"default"in e?e.default:e;function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function o(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var a="https://services.upstamps.com/api",i=t.createContext({}),s=function(e,t){switch(t.type){case"set-flags":case"set-flags-error":case"set-remotes":case"set-remotes-error":return n({},e,{},t.payload);default:throw new Error("Unhandled action type")}},u=function(){var e=t.useContext(i);if(void 0===e)throw new Error("UpStampsContext must be used with UpStampsProvider!");return e},c=["A","B"],l=function(e,t){try{return Promise.resolve(o((function(){return Promise.resolve(fetch(e)).then((function(e){return Promise.resolve(e.json()).then((function(e){var r=e.ABTesting.filter((function(e){return e.name===t})).length>0,n=Math.floor(Math.random()*c.length);return{show:r,variant:c[n],loading:!1}}))}))}),(function(e){throw e})))}catch(e){return Promise.reject(e)}},f=function(e){var i=e.children,s=u(),c=t.useState({component:[],loading:!0,error:!1,variant:"A"}),f=c[0],m=c[1],v=s.state.params,d=a+"/"+v.clientId+"/"+v.projectKey+"/"+v.envKey+"/testing";return t.useEffect((function(){!function(){try{var e=o((function(){return Promise.resolve(l(d,name)).then((function(e){var t=e.show,o=e.loading,a=e.variant;!function(e){var t=r.Children.map(i,(function(t){if(t.props.name===e)return t}));m((function(e){return n({},e,{component:t})}))}(a),m((function(e){return n({},e,{show:t,variant:a,loading:o})}))}))}),(function(){m((function(e){return n({},e,{error:!0,loading:!1})}))}));Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(e){return Promise.reject(e)}}()}),[name,s.state.params]),r.createElement(t.Fragment,null,f.component)},m=function(e){return r.createElement(t.Fragment,null,e.children)};m.displayName="ABTest.Variant",f.Variant=m,exports.ABTest=f,exports.Flag=function(e){var n=e.children,o=e.name,a=u().state;return t.useMemo((function(){return-1!==a.flags.indexOf(o)}),[a.flags,o])?r.createElement(t.Fragment,null,n):null},exports.RemoteFlag=function(e){var n=e.children,o=e.name,a=u().state,i=t.useMemo((function(){return a.remotes.filter((function(e){return e.name===o}))}),[a.remotes,o]),s=t.useMemo((function(){return i.length>0}),[i]);return s?r.createElement(t.Fragment,null,n(s?i[0].data:{})):null},exports.UpStampsContext=i,exports.UpStampsProvider=function(e){var n=e.children,u=e.clientId,c=e.envKey,l=e.projectKey,f=t.useReducer(s,{loading:!0,error:!1,flags:[],remotes:[],params:{clientId:u,envKey:c,projectKey:l}}),m=f[0],v=f[1],d=t.useMemo((function(){return{state:m,dispatch:v}}),[m,v]);return t.useEffect((function(){var e=!1;return function(){try{Promise.resolve(o((function(){if(!(m.flags.length>0))return Promise.resolve(fetch(a+"/"+u+"/"+l+"/"+c+"/flags")).then((function(t){return Promise.resolve(t.json()).then((function(t){var r=t.flags.map((function(e){return e.name}));e||v({type:"set-flags",payload:{flags:r,loading:!1}})}))}))}),(function(){v({type:"set-flags-error",payload:{loading:!1,error:!0}})})))}catch(e){return Promise.reject(e)}}(),function(){try{Promise.resolve(o((function(){if(!(m.remotes.length>0))return Promise.resolve(fetch(a+"/"+u+"/"+l+"/"+c+"/remotes")).then((function(t){return Promise.resolve(t.json()).then((function(t){e||v({type:"set-remotes",payload:{remotes:t.remotes,loading:!1}})}))}))}),(function(){v({type:"set-remotes-error",payload:{loading:!1,error:!0}})})))}catch(e){return Promise.reject(e)}}(),function(){e=!0}}),[m.flags,m.remotes,u,c,l]),r.createElement(i.Provider,{value:d},n)},exports.useABTest=function(e){var r=u(),i=t.useState({loading:!0,error:!1,show:!1,variant:"A"}),s=i[0],c=i[1],f=r.state.params,m=a+"/"+f.clientId+"/"+f.projectKey+"/"+f.envKey+"/testing";return t.useEffect((function(){!function(){try{var t=o((function(){return Promise.resolve(l(m,e)).then((function(e){var t=e.show,r=e.loading,o=e.variant;c((function(e){return n({},e,{show:t,variant:o,loading:r})}))}))}),(function(){c((function(e){return n({},e,{error:!0,loading:!1})}))}));Promise.resolve(t&&t.then?t.then((function(){})):void 0)}catch(e){return Promise.reject(e)}}()}),[e,r.state.params]),{show:s.show,error:s.error,loading:s.loading,variant:s.variant,emitter:function(){return Promise.resolve(o((function(){return Promise.resolve(function(e,t,r){return Promise.resolve(o((function(){return Promise.resolve(fetch(r,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:JSON.stringify({name:t,varA:"A"===e?1:0,varB:"B"===e?1:0})})).then((function(e){return Promise.resolve(e.json())}))}),(function(e){return e})))}(s.variant,e,m))}),(function(e){return e})))}}},exports.useFlag=function(e){var r=u().state;return{show:-1!==t.useMemo((function(){return r.flags}),[r.flags]).indexOf(e)}},exports.useRemoteFlag=function(e){var r=u().state,n=t.useMemo((function(){return r.remotes.filter((function(t){return t.name===e}))}),[r.remotes,e]),o=t.useMemo((function(){return n.length>0}),[n]);return{show:o,data:o?n[0].data:{}}};
//# sourceMappingURL=upstamps-react.cjs.production.min.js.map
