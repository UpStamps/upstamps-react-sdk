"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("react"),r=(e=t)&&"object"==typeof e&&"default"in e?e.default:e;function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function o(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var a="https://services.upstamps.com/api",s=t.createContext({}),u=function(e,t){switch(t.type){case"set-flags":case"set-flags-error":case"set-remotes":case"set-remotes-error":return n({},e,{},t.payload);default:throw new Error("Unhandled action type")}},i=function(){var e=t.useContext(s);if(void 0===e)throw new Error("UpStampsContext must be used with UpStampsProvider!");return e};exports.Flag=function(e){var n=e.children,o=e.name,a=i().state;return t.useMemo((function(){return-1!==a.flags.indexOf(o)}),[a.flags,o])?r.createElement(t.Fragment,null,n):null},exports.RemoteFlag=function(e){var n=e.children,o=e.name,a=i().state,s=t.useMemo((function(){return a.remotes.filter((function(e){return e.name===o}))}),[a.remotes,o]),u=t.useMemo((function(){return s.length>0}),[s]);return u?r.createElement(t.Fragment,null,n(u?s[0].data:{})):null},exports.UpStampsContext=s,exports.UpStampsProvider=function(e){var n=e.children,i=e.clientId,l=e.envKey,c=e.projectKey,f=t.useReducer(u,{loading:!0,error:!1,flags:[],remotes:[],params:{clientId:i,envKey:l,projectKey:c}}),m=f[0],p=f[1],d=t.useMemo((function(){return{state:m,dispatch:p}}),[m,p]);return t.useEffect((function(){var e=!1;return function(){try{Promise.resolve(o((function(){if(!(m.flags.length>0))return Promise.resolve(fetch(a+"/"+i+"/"+c+"/"+l+"/flags")).then((function(t){return Promise.resolve(t.json()).then((function(t){var r=t.flags.map((function(e){return e.name}));e||p({type:"set-flags",payload:{flags:r,loading:!1}})}))}))}),(function(){p({type:"set-flags-error",payload:{loading:!1,error:!0}})})))}catch(e){return Promise.reject(e)}}(),function(){try{Promise.resolve(o((function(){if(!(m.remotes.length>0))return Promise.resolve(fetch(a+"/"+i+"/"+c+"/"+l+"/remotes")).then((function(t){return Promise.resolve(t.json()).then((function(t){e||p({type:"set-remotes",payload:{remotes:t.remotes,loading:!1}})}))}))}),(function(){p({type:"set-remotes-error",payload:{loading:!1,error:!0}})})))}catch(e){return Promise.reject(e)}}(),function(){e=!0}}),[m.flags,m.remotes,i,l,c]),r.createElement(s.Provider,{value:d},n)},exports.useFlag=function(e){var r=i().state;return{show:-1!==t.useMemo((function(){return r.flags}),[r.flags]).indexOf(e)}},exports.useRemoteFlag=function(e){var r=i().state,n=t.useMemo((function(){return r.remotes.filter((function(t){return t.name===e}))}),[r.remotes,e]),o=t.useMemo((function(){return n.length>0}),[n]);return{show:o,data:o?n[0].data:{}}};
//# sourceMappingURL=upstamps-react.cjs.production.min.js.map
